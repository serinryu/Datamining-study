# 2. 빅데이터의 탐색 (시각화 시스템 위주)

데이터 집계 → 데이터 마트 → 시각화 

데이터 집계와 시각화 사이에 있는 것이 데이터 마트. 데이터 마트가 너무 작을 경우, 피벗 테이블과 BI 도구를 사용해 대화적인 데이터를 검색한다면 정보 부족으로 곤란한 상황이 될 것이고, 데이터 마트가 너무 거대할 경우 좋은 시각화를 할 수 없게 된다. 즉, trade off 관계에 있으며, 결국 데이터 마트의 크기에 따라 시각화 시스템 구성이 결정됨.

## 데이터베이스 지연 줄이고 고속화하기

데이터양이 증가함에 따라 집계에 걸리는 시간은 증가함. 데이터 집계에 너무 많은 시간이 소요되면, 작업 효율은 매우 악화됨. 데이터베이스의 지연은 어떻게 줄일까? 대량의 데이터를 신속하게 집계하기 위해, 미리 데이터를 **집계 효율이 높은 데이터 베이스로 변환**하는 것이 필요하다.

대화식으로 데이터를 시각화하고 그 내용을 알기 위해서는 ‘초 단위로의 고속 집계’가 요구된다. 그것을 예상해서 시스템을 다음과 같이 마련해야 함.

- 3계층의 데이터 집계 시스템 : 원 데이터를 대량의 데이터를 처리할 수 있는 **데이터 레이크와 데이터 웨어하우스**에 저장함.(수분~수시간 단위의 데이터 집계) 거기서 원하는 데이터를 추출하여 **데이터 마트**를 구축하고 여기에서는 초 단위의 응답을 얻을 수 있게 한다.(수초 단위의 크로스 집계)

→ 데이터 웨어하우스나 데이터 레이크는 대량의 데이터 처리를 위해 주로 ‘처리량(일정 시간안에 처리할 수 있는 데이터양)’을 중시하는 설계로 되어 있는 한편, 데이터 마트에 요구 되는 것은 **‘지연 시간의 단축’**


- 데이터 처리의 지연이 적은 데이터 마트 작성 : 데이터 마트를 만들 때에는 가급적 지연이 적은(latency 가 적은) 데이터베이스가 있어야 하는데, 크게 두 가지 선택이 있다.
1. 데이터가 작은 경우: 모든 데이터를 메모리에 올리면 됨. 
    - 만약 한 레코드 크기가 500바이트이면 천만 레코드의 경우 5GB. 이 정도면 MySQL 등의 일반적인 RDB가 데이터 마트에 적합함. RDB 는 지연이 적고 많은 수의 클라이언트가 동시 접속해도 성능이 나빠지지 않으므로 많은 사용자가 이용하는 실제 운영 환경의 데이터 마트로 특히 우수함. 그러나, RDB는 메모리가 부족하면 성능이 급격히 저하되므로 수억 레코드를 초과하는 데이터 집계에는 적합하지 않음.
2. 데이터가 많은 경우 : ‘MPP 데이터베이스' 등을 이용하여 ‘열 지향’ 으로 데이터가 보관되도록 하는 것이 좋음. (열 지향(column-oriented) 스토리지에 의한 고속화)
    - 고속화를 위해 사용되는 기법이 ‘압축’과 ‘분산'. 데이터를 가능한 한 작게 압축하고 그것을 여러 디스크에 분산함으로써 데이터의 로드에 따른 지연을 줄일 수 있음. 분산된 데이터를 읽어들이려면 멀티코어를 활용하면서 디스크 I/O를 병렬 처리하는 것이 효과적. 이러한 아키텍처를 MPP (massive parallel processing: 대규모 병렬 처리) 라고 함.
    - 일반적인 업무 시스템에서 사용되는 데이터베이스(Oracle Database, MySQL 과 같은 일반적인 RDB 포함) 은 “레코드 단위"의 읽고쓰기에 최적화 되어 있는 ‘행 지향 데이터베이스(row-oriented)’ 이지만, 데이터 분석에 사용되는 데이터베이스는 “칼럼 단위”의 집계에 최적화되어 있는 ‘열 지향 데이터베이스(column-oriented database)’임.  (예. Teradata, Amazon Redshint) → 열 지향 데이터베이스는 데이터 압축 효율이 우수.
    - MPP 데이터베이스를 사용하면 병렬화에 의한 쿼리 고속화가 가능함. MPP 데이터베이스에서는 여러 디스크에서 분산된 데이터가 서로 다른 CPU 코어에 의해 집계되어(CPU 코어 수에 비례하여 고속화됨) 부분적인 쿼리 실행이 이뤄지고, 그 결과들은 한 곳에 모여 최종적인 결과가 출력됨. 이러한 처리는 가능한 한 동시에 병렬로 실행됨. → ‘MPP 데이터베이스'와 ‘대화형 쿼리 엔진' 중 어느 쪽을 선택할지는 때에 따라 다르다. 시스템 안정성은 MPP 데이터 베이스, 하둡과의 궁합은 대화형 쿼리 엔진. 
    
>
    - 📌 행 지향 데이터 베이스 : 테이블의 각 행이 디스크 상에서 일련의 데이터로 쓰여짐. 새로운 레코드를 추가할 때는 끝부분에 추가되므로 고속으로 쓰기가 가능하고, 데이터 검색을 고속화하기 위해 인덱스(index) 를 만듬.  → 한편, 데이터 분석에서는 어떤 칼럼이 사용되는지 미리 알 수 없으므로 인덱스가 거의 도움되지 않음. 인덱스에 의지하지 않는 고속화 기술이 필요.
    - 📌 열 지향 데이터베이스 : 칼럼별로 데이터를 보관해두므로, 필요한 칼럼만을 로드하여 디스크 I/O 를 줄임. 데이터를 집계하는 데는 고속이지만, 데이터 저장 시에는 시간이 걸림. → 데이터 분석에서는 종종 일부 칼럼만이 집계 대상(예. 상품 종류에 따른 가격을 알고 싶다면 상품의 공장명 까지는 필요없음) 
  

⇒ 정리하면, 열 지향 스토리지와 MPP 개념을 결합함으로써 데이터의 집계가 크게 고속화된다. 
    
+) 컴퓨터의 성능 향상에 따라 데이터의 집계 속도는 해마다 빨라지고 있음. 이러한 이유로 데이터 마트를 만들지 않아도 되는 경우가 늘어나고 있음. 매번 모든 데이터를 데이터 웨어하우스에서 새롭게 집계하면 되기 때문. 그러나, 현실적으로는 크고 작은 성능상의 이유로 시스템의 부하를 낮출 필요가 있음.
